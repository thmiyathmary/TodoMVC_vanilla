<!DOCTYPE HTML>
<html>

<head>
  <title>Vanilla ES6ãƒ»TodoMVS</title>
  <link rel="stylesheet" type="text/css" href="index.css">
</head>

<body>
  <div class="center">
    <h1>todos</h1>
    <form class="whole" name="form" autocomplete="off" action="javascript:addTodo()">
      <input type="text" name="inputArea" placeholder="What needs to be done?" onsubmit="javascript:addTodo()">
    </form>
    <h6>
      Double-click to edit a todo<br>
      Written by Usui<br>
      Refactored by Usui<br>
      Part of TodoMVC<br>
  </h6>
  </div>
  <script>
    const todoList = []
    const addTodo = (function(){
      const inputArea = document.form.inputArea
      return function(){
        if(inputArea.value !== ""){
          console.log(inputArea.value)
          todoList.push({name:inputArea.value, isCompleted:false})
          inputArea.value = ""
          console.log(todoList)
          showTodoList()
        }
      }
    })()

    const showTodoList = function(){
      const form = document.form
      if(form.children.length > 1) {
        form.removeChild(form.lastElementChild)
      }
      const table = document.createElement('table')

      todoList.forEach(function(todo,index){
        const row = table.insertRow(-1)
        row.setAttribute('id', 'row' + index)
        const form = `
          <td class="checkbox">
            <input id="checkbox${index}" type="checkbox" onclick="onClickCheckBox(${index})" ` + (todo.isCompleted ? checked="checked" : "" ) + `>
          </td>
          <td>
            ${todo.name}
          </td>
          <td class="remove">
            <input type="button" value="X" onclick="onClickRemove(${index})">
          </td>
        `
        // <input type="text" value=${todo.name} disabled="disabled">
        row.innerHTML = form
      })
      form.appendChild(table)
    }

    const onClickCheckBox = function(index = -1){
      if(index !== -1){
        const checkbox = document.getElementById('checkbox' + index)
        todoList[index].isCompleted = checkbox.checked
      }
    }

    const onClickRemove = function(index = -1){
      if(index !== -1){
        todoList.splice(index,1)
        showTodoList()
      }
    }
  </script>
</body>

</html>
